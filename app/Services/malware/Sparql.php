<?php

namespace App\Services\Malware;

use App\Services\HttpService;
use Illuminate\Support\Facades\Cache;
class Sparql
{
    private $httpService;

    public function __construct(HttpService $httpService)
    {
        $this->httpService = $httpService;
    }

    public function searchEntities(string $searchTerm)
    {
        $query = 'SELECT ?entity ?property ?value
                    WHERE {
                    ?entity ?property ?value .
                    FILTER (regex(?value, "^'.$searchTerm.'", "i")) .
                    FILTER (?property IN (
                        <http://stufei/ontologies/malware#hasName>,
                        <http://stufei/ontologies/malware#name>,
                        <http://stufei/ontologies/malware#hasSubmitName>
                    )) .
                    }
                    LIMIT 3';
        $result = $this->httpService->get($query);
        Cache::put('malware', $result);

        return $result;
    }

}
